name: Make a release
# on:
#   push:
#     tags:
#       - "*.*.*"
on: [push]

jobs:
  # prepare:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Get the version
  #       id: get_version
  #       run: echo ::set-output name=VERSION::$(echo $GITHUB_REF | cut -d / -f 3)
  windows_build:
    runs-on: windows-latest
    steps:
      - name: Download Python installer
        shell: pwsh
        run: curl.exe --output installer.exe --url https://www.python.org/ftp/python/3.10.4/python-3.10.4-amd64.exe
      - name: Run installation in silent mode @ -Docs -Debug -Launcher
        shell: pwsh
        run: ./installer.exe /quiet InstallAllUsers=1 PrependPath=1 Include_doc=0 include_launcher=0
      - name: Find Python installation
        shell: pwsh
        run: |
          Set-Location -Path "C:\hostedtoolcache\windows\Python\3.9.12"
          Get-ChildItem -Force
      - name: Compress venv
        shell: pwsh
        run: |
          Compress-Archive -Path C:\hostedtoolcache\windows\Python\3.9.12\* -DestinationPath python.zip
      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: python.zip
